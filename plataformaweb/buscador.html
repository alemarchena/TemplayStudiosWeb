
<div class="container">
<nav>
    <div class="nav-wrapper">
        <form>
            <div class="input-field" id="contenedorbusqueda">
                <input id="cajabusqueda" class="autocomplete" onkeydown="validarenter(event)" type="search" required placeholder="Encuentra marcas y productos aquí">
                <label class="label-icon" for="search"><i id="consulta" class="material-icons">search</i></label>
                <i class="material-icons">close</i>
            </div>
        </form>
    </div>
</nav>
</div>
<script>

function muestrabuscar()
{
    if ($("#cajabusqueda").val() != "") {
        M.toast(
            {
                html: '...Buscando',
                displayLength: '3000'
            });
    } 
}
    function buscarproductos(tipoconsulta, e) {

        var isVisible = $("#vervineria").is(":visible");
        if (!isVisible) {

            const swalWithBootstrapButtons = Swal.mixin({
                customClass: {
                    cancelButton: 'btn btn-danger'
                },
                buttonsStyling: true
            })

            swalWithBootstrapButtons.fire({
                text: 'Por favor declare su edad!!!',
                icon: 'warning'
            })

        } else {

             var textobuscado = $("#cajabusqueda").val();

            if (textobuscado == "") {

                // Swal.fire({
                //     closeOnEsc: false,
                //     title: 'Escriba lo que desea encontrar!',
                // })
                return false;
            }

            var bdd = conexionbddpaginaweb;
            var rutadeimagenes = rutaimagenespaginaweb;
            var tabla = tablaanunciospaginaweb;
            var tabladerubros = tablarubrospaginaweb;

            //Tamañio de la imagen del anuncio
            tamanioimagen = 150;
            anchocard = 200;

           
            //Lista con filtros
            var filtro = [];
            filtro.push( textobuscado );
            
            var t = null;
            var id = 0;

            var itemanuncio = new Object();
            itemanuncio.bdd = bdd;
            itemanuncio.tabla = tabla;
            itemanuncio.tablarubros = tabladerubros;
            itemanuncio.tipo = tipoconsulta;
            itemanuncio.id = id;
            itemanuncio.rutaimagenes = rutadeimagenes;
            itemanuncio.filtro = filtro;

            var objetoanuncio = JSON.stringify(itemanuncio);

            sn= $('#seccionbuscados div');
            sn.each(function () {
                $(this).remove();
            });

            if (consinprecio == "conprecio") {
                $("#seccionbuscados").load("anuncios_tarjeta_conprecio.html");
            } else {
                $("#seccionbuscados").load("anuncios_tarjeta.html");
            }  

            t = $('#seccionbuscadosbuscador');
    
            $(".hijos").remove();

            // var trabajacomonovedad = false;
            var seveelprecio = true;

            document.getElementById("cajabusqueda").value = "";
            
            $.ajax({
                url: "consultaanuncios.php",

                data: { objetoanuncio: objetoanuncio },
                type: "post",

                success: function (data) {

                    if (data != '[]') {

                        dd = JSON.parse(data); //data decodificado
                        var cuenta = 0;
                        var parteobservacion = "";
                        var partecomentarios = "";
                        var colapsocomentarios = "";
                        var colapsoobservaciones = "";
                        var valorbonus = "";

                        $.each(dd, function (key, value) {
                            cuenta = cuenta + 1;

                            parteobservacion = "";
                            partecomentarios = "";
                            listaobservacioncomentario = "";

                            // botoncarrito = "<a href ='" + dominioruta + "carrito.html' target='_blank' class='btn waves-effect  orange green-4' type='button' id='vercarrito'" + cuenta + "  name='vercarrito'" + cuenta + "><i class='fas fa-shopping-cart'></i></a>"
                            if (dd[key].productobonus == 1) {
                                valorbonus = "Cange por " + dd[key].bonus + " bonus";
                            } else {
                                valorbonus = "";
                            }


                            if (dd[key].tieneventaja) {

                                tituloventaja = dd[key].tituloventaja;
                                precioventaja = "$ " + dd[key].precioventaja;

                                if (tituloventaja.trim() == "" || precioventaja == 0) {
                                    tituloventaja = "";
                                    precioventaja = "";
                                }
                            } else {
                                tituloventaja = "";
                                precioventaja = "";
                            }

                            // Observaciones y comentarios
                            if (dd[key].observaciones != "") {
                                parteobservacion = "<li class=''> <div class='collapsible-header'><i class='material-icons icosabermas'>chrome_reader_mode</i>Saber mas...</div><div class='collapsible-body'><span>" + dd[key].observaciones + "</span></div></li>";
                            } else {
                                parteobservacion = "";

                            }

                            if (dd[key].comentarios != "") {
                                partecomentario = "<li class=''> <div class='collapsible-header'><i class='material-icons icosugerencias'>comment</i>Sugerencias</div><div class='collapsible-body'><span>" + dd[key].comentarios + "</span></div></li>"
                            } else {
                                partecomentario = ""

                            }

                            var agregado = "";
                            var iconomasinfo = "";

                            if (parteobservacion != "" || partecomentario != "") {

                                listaobservacioncomentario = "<ul class='collapsible'>" + parteobservacion + partecomentario + "</ul> ";
                                agregado = "<div class='card-reveal'> <span class='card-title grey-text text-darken-4'>Información<i class='material-icons right'>close</i></span>" + listaobservacioncomentario + "</div>"
                                iconomasinfo = "<i class='material-icons right'>more_vert</i>";
                            }
                            // -----------------------------

                            if (dd[key].nopublicar == 0) {
                                if (seveelprecio == true) {

                                    var precio;
                                    if (dd[key].precio > 0) {
                                        precio = "$ " + dd[key].precio;
                                    } else {
                                        precio = "Consultar Precio";
                                        tituloventaja = "";
                                        precioventaja = "";
                                    }
                                    t.append("<div class='col s12 m6 l3 hijos'><div class='card'><div id='tarjetaimagen' class='card-image waves-block waves-light'><img src='" + rutadeimagenes + dd[key].imagen + "' class=' materialboxed center-align tamaimagen'  alt='...'></img></div><div class='card-content'><span class='card-title activator grey-text text-darken-4'><h5 id='titulotarjeta' class='center'>" + dd[key].titulo + "</h5>" + iconomasinfo + "</span><p id='descripciontarjeta' class='card-text center m-1'>" + dd[key].descripcion + "</p><hr><div class='row '><div class='col s6 '><p id='preciotarjeta' class='filapreciotarjeta preciotarjeta'>" + precio + "</p></div><div class='col s6'><p class='valorbonus'>" + valorbonus + "</p></div></div><div class='row '><div class='col s6 '><p id='titventaja' class='tituloventaja '>" + tituloventaja + "</p><p id='preventaja' class='precioventaja'><del>" + precioventaja + "</del></p></div><div class='col s6'><p><a href='#'>Link de pago</a></p></div></div></div>" + agregado + "</div></div>");

                                    // t.append("<div class='col s12 m6 l3 hijos'><div class='card'><div id='tarjetaimagen' class='card-image waves-block waves-light'><img src='" + rutadeimagenes + dd[key].imagen + "' class=' materialboxed center-align tamaimagen'  alt='...'></img></div><div class='card-content'><h5 id='titulotarjeta' class='center'>" + dd[key].titulo + "</h5><p id='descripciontarjeta' class='card-text center m-1'>" + dd[key].descripcion + "</p><hr><div class='row '><div class='col s6 '><p id='preciotarjeta' class='filapreciotarjeta preciotarjeta'>" + precio + "</p></div><div class='col s6'><p class='valorbonus'>" + valorbonus + "</p></div></div><div class='row '><div class='col s6 '><p id='titventaja' class='tituloventaja '>" + tituloventaja + "</p><p id='preventaja' class='precioventaja'><del>" + precioventaja + "</del></p></div><div class='col s6'><p><a href='#'>Link de pago</a></p></div></div></div>" + listaobservacioncomentario + "</div></div>");
                                }
                            }
                        });

                        imageneszoom();

                        $('.collapsible').collapsible();

                    } else {
                        Swal.fire({
                            title: 'No hay artículos para esta búsqueda !!!'
                        })
                    }
                },
                error: function (e) {
                    console.log("Error de comunicación");
                }
            });
            resetopciones();
            var alturamenu = $('.menu').outerHeight(true);
            var iraqui = $("#seccionbuscadosbuscador").offset().top - alturamenu;
            $("HTML, BODY").animate({ scrollTop: iraqui }, velocidadscroll);
        }
    }

    function validarenter(e)
    {
            var key = window.event ? e.which : e.keyCode;

            if (key== 13) 
            {
                buscarproductos("consultafiltros");
                muestrabuscar();

            }
        
    }

    $("#cajabusqueda").keydown(function () {

        if($("#cajabusqueda").val() != "")   {
            resetopciones();
        }

    });

    function resetopciones(){

        $("#opciones option:selected").prop("selected", false);
        $(this).prop("selected", true);
    }

    $(document).ready(function () {
        $("#consulta").click(function () {

            
                buscarproductos("consultafiltros");
                muestrabuscar();
                // $(".navbar-collapse").collapse("hide");
            
        });

        

    });


    $("#menunegocio").on('click', function (e) {

        e.preventDefault();
        $("html, body").animate({ scrollTop: 0 }, velocidadscroll * 1.2);
        // $(".navbar-collapse").collapse("hide");
    });

     
</script>