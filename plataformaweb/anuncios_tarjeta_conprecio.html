<head>
    <meta name="viewport" content="width = device-width, initial-scale = 1">
    
    <link href="cover.css" rel="stylesheet">

</head>

<div class="row" style="z-index: 50;">
    <div class="col s12 m6 l3 offset-m3 offset-m6" style="z-index: 50;">
        
        <div class="input-field" style="z-index: 50;">
            <select id="opcionesconprecio" style="z-index: 50;">
               
               
            </select>
        </div>

    </div>
</div>

<div id="buscadosenprecios" class="row">
    
</div>
    
                              



                                    
<script>

    var bdd = conexionbddpaginaweb;
    var rutadeimagenes = rutaimagenespaginaweb;
    var tabla = tablaanunciospaginaweb;
    var tabladerubros = tablarubrospaginaweb;

    function consultaranunciostarjetaconprecio(e)
    {
        var seveelprecio = true;
        var seleccion = document.getElementById("opcionesconprecio");
        // var seleccionrubro = seleccion.options[seleccion.selectedIndex].text;
        
        var seleccionidrubro = document.getElementById("opcionesconprecio").value;
        
        
        if (seleccionidrubro != "")
        {

        
            var tipo;
            tipo = "consultarubros";

            var t=null;
            var id="";

            if (id == "") id = 0;
            else id = id;

            var itemanuncio = new Object();

            itemanuncio.bdd = bdd;
            itemanuncio.tabla = tabla;
            itemanuncio.tablarubros = tabladerubros;

            itemanuncio.tipo = tipo;
            itemanuncio.id = id;

            itemanuncio.titulo = "";
            itemanuncio.descripcion = "";
            itemanuncio.precio = "";
            itemanuncio.costo = "";
            itemanuncio.esnovedad = "";
            itemanuncio.esoferta = "";
            itemanuncio.nopublicar = "";
            itemanuncio.observaciones = "";
            itemanuncio.comentarios = "";

            itemanuncio.rutaimagenes = rutadeimagenes;
            itemanuncio.idrubro = seleccionidrubro;
            itemanuncio.imagen = "";
            itemanuncio.filtro = "";

            var objetoanuncio = JSON.stringify(itemanuncio);

            sn = $('#buscadosenprecios div');
            sn.each(function () {
                $(this).remove();
            });


            t = $('#buscadosenprecios');
            $(".hijos").remove();

            $.ajax({
                url: "consultaanuncios.php",

                data: { objetoanuncio: objetoanuncio},
                type: "post",

                success: function (data)
                {
                    
                    if (data != '[]') {
                        
                        dd = JSON.parse(data); //data decodificado
                        var cuenta = 0;
                        var parteobservacion = "";
                        var partecomentarios = "";
                        var colapsocomentarios = "";
                        var colapsoobservaciones = "";
                        var valorbonus="";

                        $.each(dd, function (key, value) 
                        {
                            cuenta = cuenta + 1;

                            parteobservacion = "";
                            partecomentarios = "";
                            listaobservacioncomentario = "";

                            // botoncarrito = "<a href ='" + dominioruta + "carrito.html' target='_blank' class='btn waves-effect  orange green-4' type='button' id='vercarrito'" + cuenta + "  name='vercarrito'" + cuenta + "><i class='fas fa-shopping-cart'></i></a>"
                            if (dd[key].productobonus == 1) 
                            {
                                valorbonus = "Cange por " + dd[key].bonus + " bonus";
                            }else
                            {
                                valorbonus = "";
                            }


                            if(dd[key].tieneventaja){
                                
                                tituloventaja = dd[key].tituloventaja;
                                precioventaja = "$ " + dd[key].precioventaja;
                                 
                                if (tituloventaja.trim() == "" || precioventaja == 0)
                                {
                                    tituloventaja = "";
                                    precioventaja = "";    
                                }
                            }else{
                                tituloventaja = "";
                                precioventaja = "";
                            }

                            // Observaciones y comentarios
                            if (dd[key].observaciones != "" ) {
                                parteobservacion = "<li class=''> <div class='collapsible-header'><i class='material-icons icosabermas'>chrome_reader_mode</i>Saber mas...</div><div class='collapsible-body'><span>" + dd[key].observaciones + "</span></div></li>";
                            }else
                            {
                                parteobservacion = "";
                                
                            }
                                                            
                            if (dd[key].comentarios != "") {
                                partecomentario = "<li class=''> <div class='collapsible-header'><i class='material-icons icosugerencias'>comment</i>Sugerencias</div><div class='collapsible-body'><span>" + dd[key].comentarios + "</span></div></li>"
                            } else {
                                partecomentario  = ""
                                
                            }

                            var agregado="";
                            var iconomasinfo = "";
                            
                            if(parteobservacion != "" || partecomentario != ""){

                                listaobservacioncomentario = "<ul class='collapsible'>" + parteobservacion + partecomentario + "</ul> ";
                                agregado = "<div class='card-reveal'> <span class='card-title grey-text text-darken-4'>Información<i class='material-icons right'>close</i></span>" + listaobservacioncomentario + "</div>"
                                iconomasinfo = "<i class='material-icons right'>more_vert</i>";
                            }                           
                            // -----------------------------

                            if (dd[key].nopublicar == 0) 
                            {
                                if(seveelprecio==true){
                                   
                                    var precio;
                                    if (dd[key].precio > 0) {
                                        precio = "$ " + dd[key].precio;
                                    } else { 
                                        precio = "Consultar Precio"; 
                                        tituloventaja = "";
                                        precioventaja = ""; 
                                    }
                                        
                                    // t.append("<div class='col s12 m6 l3 hijos'><div class='card'><div id='tarjetaimagen' class='card-image waves-block waves-light'><img src='" + rutadeimagenes + dd[key].imagen + "' class=' materialboxed center-align tamaimagen'  alt='...'></img></div><div class='card-content'><h5 id='titulotarjeta' class='center'>" + dd[key].titulo + "</h5><p id='descripciontarjeta' class='card-text center m-1'>" + dd[key].descripcion + "</p><hr><div class='row '><div class='col s6 '><p id='preciotarjeta' class='filapreciotarjeta preciotarjeta'>" + precio + "</p></div><div class='col s6'><p class='valorbonus'>" + valorbonus + "</p></div></div><div class='row '><div class='col s6 '><p id='titventaja' class='tituloventaja '>" + tituloventaja + "</p><p id='preventaja' class='precioventaja'><del>" + precioventaja + "</del></p></div><div class='col s6'><p><a href='#'>Link de pago</a></p></div></div></div>" + listaobservacioncomentario + "</div></div>");
                                    t.append("<div class='col s12 m6 l3 hijos'><div class='card'><div id='tarjetaimagen' class='card-image waves-block waves-light'><img src='" + rutadeimagenes + dd[key].imagen + "' class=' materialboxed center-align tamaimagen'  alt='...'></img></div><div class='card-content'><span class='card-title activator grey-text text-darken-4'><h5 id='titulotarjeta' class='center'>" + dd[key].titulo + "</h5>" + iconomasinfo + "</span><p id='descripciontarjeta' class='card-text center m-1'>" + dd[key].descripcion + "</p><hr><div class='row '><div class='col s6 '><p id='preciotarjeta' class='filapreciotarjeta preciotarjeta'>" + precio + "</p></div><div class='col s6'><p class='valorbonus'>" + valorbonus + "</p></div></div><div class='row '><div class='col s6 '><p id='titventaja' class='tituloventaja '>" + tituloventaja + "</p><p id='preventaja' class='precioventaja'><del>" + precioventaja + "</del></p></div><div class='col s6'><p><a href='#'>Link de pago</a></p></div></div></div>" + agregado + "</div></div>");
                                }
                            }
                        });

                        imageneszoom();

                        $('.collapsible').collapsible();

                    }
                    else
                    {
                        if(seleccionidrubro!="")
                        {
                            Swal.fire({
                                closeOnEsc: false,
                                title: 'No hay novedades para estea categoría!',

                            })
                        }
                    }
                },
                    error: function (e) {
                        M.toast(
                            {
                                html: 'No hay buena conexión!',
                                displayLength: '4000'
                            });
                    console.log("Error de comunicación");
                }
            });
        }

        // var poscontacto = $("#buscadosenprecios").offset().top - alturamenu;
        // $("HTML, BODY").animate({ scrollTop: poscontacto }, velocidadscroll);
    }
    
    function inicializaselect(){
        $('select').formSelect();
    }

    function declaracollapsible(){

        $('.collapsible').collapsible();
    }

    $(document).ready(function ()
    {
         declaracollapsible();

        inicializaselect();
        $('select').on('contentChanged', function () {
            inicializaselect();
        });
        

        window.addEventListener("load", inicio);

        function inicio()
        {
            consultarubros_seleccionconpreciopaginaweb();
            consultaranunciostarjetaconprecio();
        }

        consultarubros_seleccionconpreciopaginaweb();
  

        $('#tablaanuncios').on('page.dt', function () {
            imageneszoom();
            // var poscontacto = $("#seccionnovedades").offset().top - alturamenu;
            // $("HTML, BODY").animate({ scrollTop: poscontacto }, velocidadscroll);
        });

        $("#botbuscartarjeta").on('click', function (e) {
            e.preventDefault();
            M.toast(
                {
                    html: '...Buscando',
                    displayLength: '3000'
                });
            consultaranunciostarjetaconprecio();
            // var poscontacto = $("#seccionnovedades").offset().top - alturamenu;
            // $("HTML, BODY").animate({ scrollTop: poscontacto }, velocidadscroll);
           
        });

        $("#opcionesconprecio").on('change',function(){
            consultaranunciostarjetaconprecio();
            M.toast(
            {
                html: '...Buscando',
                displayLength: '3000'
            });
        });

        
    });
</script>