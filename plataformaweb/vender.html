
<div id="accordionVentas" >
    
    <div id="collapseMasOpciones" class="collapse" aria-labelledby="headingMasOpciones" data-parent="#accordionVentas">

        <div class="filafondo row justify-content-center pt-4">
            <div class="col-sm-12 col-md-2">
                <div id="divverdata" class="row justify-content-start"></div>
            </div>
            <div class="col-sm-12 col-md-2">
                <label>
                    <input id="verconimagen" type='checkbox' class='filled-in' /><span class='colorletras'>Mostrar imagenes</span>
                </label>
            </div>
            <div class="col-sm-12 col-md-4">
                <div class="row justify-content-center ">
                    <h5 class="m-1 p-1">
                        <input id="fechaventa" type="text" class="datepicker center" readonly>
                    </h5>
                    <h5 id="fechaventalectura" type="text" style="display: none;"></h5>
                </div>
            </div>
            <div class="col-sm-12 col-md-4">
                <button id="nuevoclienteventas" style="color: white;" class="waves-effect waves-light btn-small">Clientes</button>
            </div>
        </div>
    </div>

    <div class="filafondo row justify-content-center align-items-center pt-4">

        
        <div class="col-sm-12 col-md-3"></div>
        <div class="col-sm-12 col-md-3">
            <div class="row justify-content-center">
                <select class="js-example-basic-single form-control m-1 p-1" id="opcioneslistaclientes" name="opcioneslistaclientes"></select>
            </div>
        </div>
        <div class="col-sm-12 col-md-3">
            <div class="row justify-content-center">
                <select class="form-control m-1 p-1" id="opcioneslistatiposdepago" name="opcioneslistatiposdepago"></select>
            </div>
        </div>
        <div class="col-sm-12 col-md-3" id="headingMasOpciones">
            <button class="btn collapsed" data-toggle="collapse" data-target="#collapseMasOpciones" aria-expanded="false"
                aria-controls="collapseMasOpciones">
                Mas opciones
            </button>
        </div>
    </div>
    
    <!-- ---------- OBJETO BASE PARA ALTA DE PRODUCTOS-------------- -->
    <div id="divNuevoCliente" style="display: none;"  class="row"></div>

    <div id="pedido" style="display: none;" class="notapedido">
        <!-- lista venta -->
        <div class="row pb-3">
            <!-- Columna de tarjeta de ventas -->
            <div class="col-sm-8">

                <div class="table-responsive">
                    <table id="tablaitemsventa" class="display table table-striped" style="width: 100%!important;">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Título</th>
                                <th>Cantidad</th>
                                <th>Unidad Vta</th>
                                <th>Precio</th>
                                <th>Sub Total</th>
                                <th>Eliminar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-sm-2">
                <input id="totalpedido" value="0" type="text" class="center" style="font-size: 1.3em;"
                    readonly>
            </div>
            <div class="col-sm-2">
                <button id="procesarpedido" class="btn btn-primary">Guardar <i class="fas fa-save"></i></button>
            </div>
        </div>
    </div>
    <!-- -----------Forma de pago dividido ------------ -->
    <div id="divdvp" style="display: none;">
        <div class="row ">
            <div class="col-sm-12 col-md-4 offset-md-4">
                <div class="table-responsive">
                    <table id="tabladvp" class="display table table-striped" style="width: 100%!important;">
                        <thead>
                            <tr>
                                <th>Tipo de pago</th>
                                <th></th>
                                <th>Monto</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row mb-0">
                <div class="col-sm-12 mb-0">
                    <div id="divBuscador" class="row justify-content-center mb-0">
                        <!-- ------------INSERTA COMPONENTE BUSQUEDA------------------- -->
                        
        
                        <!-- ---------------------------------------------------------- -->
                    </div>
                </div>
    </div>
    <!-- Buscar para Vender -->
    <div class="row">
        <!-- Columna de lista de anuncios -->
        <div class="col-sm-12">
            
            
            <div class=" col-sm-2">
                <!-- cliente elegido -->
                <input style="display: none;" id="idclienteelegido" name="idclienteelegido" type="text">
                <input style="display: none;" id="clienteelegido" name="clienteelegido" type="text">
                <input style="display: none;" id="idtipodepagoelegido" name="idtipodepagoelegido" type="text">
                <input style="display: none;" id="tipodepagoelegido" name="tipodepagoelegido" type="text">
            </div>

            
            <div id="listaproductos" style="display: none;" class="table-responsive">
                <table id="tablaanunciosvender" class="display table table-striped" style="width: 100%!important;">
                    <thead>
                        <tr>
                            <th class=" center" ></th>
                            <th class=" columnadedos center">Stock</th>
                            <th class=" center">Titulo</th>
                            <th class=" center">$ vta</th>
                            <th class=" center" style="font-size: 0.9em;" ></th>
                            <th class=" center" ></th>
                            <th class=" columnadetres center">cantidad</th>
                            <th class=" columnadedos center">$ lista</th>
                            <th class=" columnadedos">Imagen</th>
                            <th class=" columnadedos center">Id</th>
                            <th class=" columnadedos center">Codigo Barra</th>
                            <th class="">Descripcion</th>
                            <th class="columnadedos center">Unidad Vta</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class=" center"></td>
                            <td class=" columnadedos center"></td>
                            <td class= ""></td>
                            <td class="  center"></td>
                            <td class="  center botcelu"></td>
                            <td class="  center"></td>
                            <td class=" columnadedos center"></td>
                            <td class=" columnadedos center"></td>
                            <td class=" columnadedos"></td>
                            <td class=" columnadedos center"></td>
                            <td class="  center"></td>
                            <td class=" columnadedos center"></td>
                            <td class=""></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- Fin vender -->

              
    <!-- ------------------------------ lista de ventas del dia ------------------------ -->
    <div class="card">
        <div class="" id="headingListaVenta">
            <h5 class="m-0">
                <button class="btn collapsed" data-toggle="collapse" data-target="#collapseListaVenta"
                    aria-expanded="false" aria-controls="collapseListaVenta">
                    Lista de ventas del día
                </button>
            </h5>
           <div class="row justify-content-center">
               <div class="col-sm-12 col-md-3 center">
                   <h5 id="totalventas">0</h5>
               </div>
            </div>
        </div>
        
        <div id="collapseListaVenta" class="collapse" aria-labelledby="headingListaVenta" data-parent="#accordionVentas">
            <div id="divquitar" style="display: none;background-color: rgb(250, 228, 200);" class="p-2">
                <div class="row justify-content-center">
                    <h5>Eliminar un item de cobro dividido</h5>
                </div>
                <div class="row justify-content-center">
                    <button class="btn" id="cerrarquitar">Cerrar</button>
                </div>
                <div class="row justify-content-center">
                    <div class="col-sm-12 col-md-2">
                        <label for="montoeliminar">Total Monto en venta a eliminar</label>
                        <input class="center" type="text" name="montoeliminar" id="montoeliminar" readonly>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <p>Especifique que montos debe aplicar el sistema en el pago dividido</p>
                </div>
                <div class="row ">
                    <div class="col-sm-12 col-md-6">
                        <div class="table-responsive">
                            <table id="tabladvpcobrado" class="display table table-striped" style="width: 100%!important;">
                                <thead>
                                    <tr>
                                        <th>Tipo de pago cobrado</th>
                                        <th></th>
                                        <th>Monto cobrado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-6">
                        <div class="table-responsive">
                            <table id="tabladvpquitar" class="display table table-striped" style="width: 100%!important;">
                                <thead>
                                    <tr>
                                        <th>Tipo de pago</th>
                                        <th></th>
                                        <th>Monto a <b style="color: red;">Quitar</b> de la cobranza</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                    </div>
                </div>
                    
                <div class="row justify-content-center">
                    <p id="advertenciaquitar"></p>
                </div>
                <div class="row justify-content-center">
                    <button id="eliminarquitar" class="btn">Eliminar</button>
                </div>
            </div>
            <div class="">
                <!-- lista venta -->
                <div class="row m-0 p-0">

                    <!-- Columna de tarjeta de ventas -->
                    <div class="col-sm-12 notapedido">
                    <div id="divverdata1" class="row justify-content-start">
                        <div class="col-sm-1 mt-1">
                            <select class="form-control" id="listareg1" name="listareg1"></select>

                        </div>
                    </div>

                        <div class="table-responsive">
                            <table id="tablavender" class="display table table-striped" style="width: 100%!important;">
                                <thead>
                                    <tr>
                                        <th class=" columnadedos center">Nº Item</th>
                                        <th class=" columnadedos center">Id</th>
                                        <th class=" columnadedos center">Código Barra</th>
                                        <th class="  center">Título</th>
                                        <th class=" columnadedos center">cantidad</th>
                                        <th class=" columnadedos center">Unid.Vta</th>
                                        <th class=" columnadedos center">Precio</th>
                                        <th class=" columnadedos center">Total</th>
                                        <th class=" columnadedos center">Forma Pago</th>
                                        <th class=" columnadedos center">Hora</th>
                                        <th class=" columnadedos center">Id Cliente</th>
                                        <th class=" columnadedos center">Cliente</th>
                                        <!-- <th class=" columnadetres center">usuario</th> -->
                                        <th class=" columnadedos center">Bonus Vta</th>
                                        <th class=" columnadedos center">Eliminar</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class=" columnadedos center"></td>
                                        <td class=" columnadedos center"></td>
                                        <td class=" columnadedos center"></td>
                                        <td class="  center"></td>
                                        <td class=" columnadedos center"></td>
                                        <td class=" columnadedos center"></td>
                                        <td class=" columnadedos center"></td>
                                        <td class=" columnadedos center"></td>
                                        <td class=" columnadedos center"></td>
                                        <td class=" columnadedos center"></td>
                                        <td class=" columnadedos center"></td>
                                        <!-- <td class=" columnadedos center"></td> -->
                                        <td class=" columnadetres center"></td>
                                        <td class=" columnadedos center"></td>
                                        <td class="blockeliminar"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
                <!-- fin lista venta -->
            </div>
        </div>
    </div>
    
    <!-- ------------------------------------------- CAJA ---------------------------------------- -->
    <div class="card">
        <div class="" id="headingListaCaja">
            <h5 class="m-0">
                <button class="btn collapsed" data-toggle="collapse" data-target="#collapseListaCaja" aria-expanded="false"
                    aria-controls="collapseListaCaja">
                    Lista de Caja del día
                </button>
            </h5>
            <label for="totalcaja">Total de Caja</label>
            <h5 id="totalcaja">0</h5>
            <label for="totalefectivocaja" style="color:burlywood">Total efectivo de Caja</label>
            <h5 id="totalefectivocaja" style="background-color: burlywood; color:rgb(11, 70, 8);">0</h5>

        </div>
    
        <div id="collapseListaCaja" class="collapse" aria-labelledby="headingListaCaja" data-parent="#accordionVentas">
            <div class="">
                <!-- lista caja -->
                <div class="row m-0 p-0">
                    <!-- Columna de tarjeta de caja -->
                    <div class="col-sm-12">
    
                        <div class="row justify-content-center bd-highlight">
                            
                            <div class="col-sm-7">
                                <input id="descripcioncaja" min=0 max=150 type="text" placeholder="Descripción">
                            </div>
                            <div class="col-sm-1">
                                <input id="montocaja" type="number" min="0" max="10" placeholder="Monto">
                            </div>
                            <div class="col-sm-2">
                                <button id="ingresocaja" class="btn " style="background-color: cornflowerblue;color:white">Ingresar</button>
                            </div>
                            <div class="col-sm-2">
                                <button id="egresocaja" class="btn btn-red">Retirar</button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table id="tablacajas" class="display table table-striped" style="width: 100%!important;">
                                <thead>
                                    <tr>
                                        <th>Nº Item</th>
                                        <th>Id usuario</th>
                                        <th>Usuario</th>
                                        <th>Fecha</th>
                                        <th>Hora</th>
                                        <th>Tipo de movimiento</th>
                                        <th>Monto</th>
                                        <th>Descripción</th>
                                        <th>Eliminar</th>
    
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td></td><td></td><td></td><td></td>
                                        <td></td><td></td><td></td>
                                        <td></td><td class="blockeliminar"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
    
                </div>
                <!-- fin lista caja -->
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-sm-4">
            <h5>Resúmen de Caja</h5>
        </div>
    </div>
    
    <!-- ------------------------------------------- RESUMEN ---------------------------------------- -->
    <div class="row justify-content-center">
        <div class="col-sm-4">
            <a id="exportararchivo" style="color: white;" class="waves-effect waves-light btn-small">Exportar <i
                            class="fas fa-shopping-cart" style="color: white;"></i></a>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-sm-4">
            <div class="table-responsive">
                <table id="tablaresumen" class="display table table-striped" style="width: 100%!important;">
                    <thead>
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-sm-4">
            <div class="table-responsive">
                <table id="tablaresumendvp" class="display table table-striped" style="width: 100%!important;">
                    <thead>
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
</div>
<div class="row" style="display: none;">
    <div class="col-sm-4">
        <input type="text" id="bonusestablecido" value="" class="center" readonly>
    </div>
    <div class="col-sm-8">
        <p>% de bonus por venta</p>
    </div>
</div>
<script>
var totalmontodvp = 0;
var totalmontodvpquitar = 0;

function consultaventadiaactual() {
    
    // consultarventasdeldia();
    consultarventasdeldiadvp();
           

}

function verificaJerarquia()
{
   
    if(jerarquia == 0)
    {
        document.getElementById("fechaventa").style.display = "none";
        document.getElementById("fechaventalectura").style.display = "inline-flex";
    }
}
    cargarLista1("listareg1");
    function cargarLista1(lista) {
        $("#" + lista).empty();
        var a = [];
        a.push('<option value = "" selected >Todo</option >');
        a = a.concat('<option value = 10 >10</option>');
        a = a.concat('<option value = 25 >25</option>');
        a = a.concat('<option value = 50 >50</option>');
        a = a.concat('<option value = 100>100</option>');
        $("#" + lista).append(a);

        //selecciona el primer item
        $("#" + lista + " option:selected").prop("selected", false);
        $(this).prop("selected", true);
    }

    $("#listareg1").on('change', function () {
        var lr = document.getElementById("listareg1").value;
        var valor = -1;
        if (lr > 0)
            valor = lr;

        verRegistros("tablavender", valor);
    });

    $(document).ready(function () 
    {
        configuracalendario();
        consultarbonus();
        consultaclientes_seleccion_lista(); //llena la lista de clientes del buscador
        consultatiposdepago_seleccion_lista(); //llena la lista con tipos de pago
        imageneszoom();

        configuraciontablaPedido();
        configuraciontablavender();
        configuraciontablacajas();
        configuraciontablaanunciosvender();
        configuraciontabladvp();
        $('.js-example-basic-single').select2();

        $("#divNuevoCliente").load("componenteclientes.html");

        $("#nuevoclienteventas").click(function(){

            MostrarDivNuevoCliente();
        });

        function MostrarDivNuevoCliente()
        {   
            if($("#divNuevoCliente").hasClass("show"))
            {
                $("#divNuevoCliente").css('display','none');
                $("#divNuevoCliente").removeClass('show');
                consultaclientes_seleccion_lista();
            }
            else
            {
                $("#divNuevoCliente").css('display','block');
                $("#divNuevoCliente").addClass('show');
            }
        }

        $('#tablaanunciosvender').on('page.dt', function () {
            imageneszoom();
            identificasaltainput('saltacantidad');
            identificasaltainput('saltaprecio');
        });

        $('#tablaanunciosvender').on('draw.dt', function () {
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
            imageneszoom();
            identificasaltainput('saltacantidad');
            identificasaltainput('saltaprecio');
        });

        $("#fechaventa").change(function () {
            consultaventadiaactual();
        });

        $("#opcioneslistaclientes").change(function () {
            var o = document.getElementById("opcioneslistaclientes");
            var opcion = o.options[o.selectedIndex].text;
            document.getElementById('clienteelegido').value = opcion;
        });

        $("#opcioneslistatiposdepago").change(function () {
            var o = document.getElementById("opcioneslistatiposdepago");
            var opcion = o.options[o.selectedIndex].text;
            document.getElementById('tipodepagoelegido').value = opcion;
            eligetipopago();
        });
        
        function colocafechaactual() {
            var f = new Date();
            var mes = f.getMonth() + 1;
            var dia = f.getDate();
            if (dia < 10) {
                dia = "0" + dia;
            }
            if (mes < 10) {
                mes = "0" + mes;
            }
            var fechaactual = dia + "-" + mes + "-" + f.getFullYear();
            document.getElementById("fechaventa").value = fechaactual;
            document.getElementById("fechaventalectura").innerHTML = fechaactual.toString();
            consultaventadiaactual();
        }
        
        colocafechaactual();

        llama = "vender";
        $("#divBuscador").load("componentebuscador.html?n=4");

        verificabloqueo();
        verificaJerarquia();
    });

   
    $("#procesarpedido").click(function(){
        procesarventa();
    });

    $("#ingresocaja").click(function()
    {
        var monto = document.getElementById("montocaja").value;
        var descripcion = document.getElementById("descripcioncaja").value;

        guardarcaja("alta", "EN",monto, descripcion);
    });

    $("#egresocaja").click(function () {
            var monto = document.getElementById("montocaja").value;
            var descripcion = document.getElementById("descripcioncaja").value;

            guardarcaja("alta", "SA",monto, descripcion);
        });
    $('.tooltipped').tooltip();

    $("#divverdata").load("componentelistaverdata.html?n=1" + versionts);

    $("#exportararchivo").click(function () {
            exportTableToExcel('tablaresumen', 'resumencajadeldia');
            exportTableToExcel('tablaresumendvp', 'resumencajadeldiadvp');
    });

    $("#cerrarquitar").click(function(){
        document.getElementById("divquitar").style.display = "none";
    });

    function confirmaEliminar(){
         const swalWithBootstrapButtons = Swal.mixin({
            customClass: {
                confirmButton: 'btn btn-success',
                cancelButton: 'btn btn-danger'
            },
            buttonsStyling: false
        })

        swalWithBootstrapButtons.fire({
            title: 'Desea eliminar ?',
            text: "Esta acción no se podrá revertir!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Si, eliminar!',
            cancelButtonText: 'No, cancelar!',
            reverseButtons: true
        }).then((result) => {
            if (result.value) {
                eliminardvpitem();
            } else if (
                result.dismiss === Swal.DismissReason.cancel
            ) {
                swalWithBootstrapButtons.fire(
                    'Perfecto',
                    'Todo sigue como estaba'
                )
            }
        })
    }

    function eliminardvpitem()
    {
        for (var a = 0; a < arrecobrado.length; a++) {
            if (arrecobrado[a].monto == arrdvpquitar[a].monto) {
                eliminamodificadvp("eliminardvp", arrecobrado[a].numdvp, arrdvpquitar[a].nombrecorto, "");

            }
            else {
                if (arrdvpquitar[a].monto > 0) {
                    var montoadescontar = arrecobrado[a].monto - arrdvpquitar[a].monto;
                    eliminamodificadvp("modificardvp", arrecobrado[a].numdvp, arrdvpquitar[a].nombrecorto, montoadescontar);

                }
            }
            var idventa = arrdvpquitar[a].itemparaquitar.idventa;
            var idcliente = arrdvpquitar[a].itemparaquitar.idcliente;
            var bonusventa = arrdvpquitar[a].itemparaquitar.bonusventa;
            var numdvppasado = arrdvpquitar[a].itemparaquitar.numdvppasado;
        }
        // console.log("ver datos");
        eliminaventa(idventa, idcliente, bonusventa, numdvppasado);
        document.getElementById("divquitar").style.display = "none";
    }

    $("#eliminarquitar").click(function(){

        confirmaEliminar();

    })
    //---------------------------------------------------------------------

    function eliminamodificadvp(tipopasado,numdvppasado,nombrecortopasado,montopasado)
    {
        var bdd = conexionbdd;
        var tabla = tabladvp;
        var tipo = tipopasado;
        var numdvp = numdvppasado;
        var tipopago = nombrecortopasado;
        var monto = montopasado;
        var email = emailingreso;
        $.ajax({
            url: "consultadvp.php?n=1",
            data: { bdd: bdd, tabla: tabla, tipo: tipo, email:email,tipopago:tipopago, monto: monto, numdvp: numdvp},
            type: "post",
            success: function (data) {
                if (data > 0) {
                    M.toast({ html: 'Ok guardado', displayLength: '1000', classes: 'rounded' });
                } else {
                    M.toast({ html: 'Error al crear el registro' })
                }
            },
            error: function (e) {
                M.toast({ html: 'Error al intentar guardar.' });
            }


        });
    }

    
    function configuraciontabladvp(){
        $('#tabladvp').DataTable({
            "language": {

                "processing": "Procesando...",
                "search": "Sub búsqueda:",
                "lengthMenu": "Mostrar _MENU_ registros",
                "info": "Registro: _START_ de _END_ - Total: _TOTAL_",
                "emptyTable": "No hay registros guardados",
                "zeroRecords": "No hay registros guardados",
                "infoEmpty": "No hay anuncios para mostrar",
                
                "pageLength": 10,

            },
            
            "dom": 'rt<"clear">'

        });
        $('#tabladvpquitar').DataTable({
            "language": {

                "processing": "Procesando...",
                "search": "Sub búsqueda:",
                "lengthMenu": "Mostrar _MENU_ registros",
                "info": "Registro: _START_ de _END_ - Total: _TOTAL_",
                "emptyTable": "No hay registros guardados",
                "zeroRecords": "No hay registros guardados",
                "infoEmpty": "No hay anuncios para mostrar",

                "pageLength": 10,

            },

            "dom": 'rt<"clear">'

        });
        $('#tabladvpcobrado').DataTable({
            "language": {

                "processing": "Procesando...",
                "search": "Sub búsqueda:",
                "lengthMenu": "Mostrar _MENU_ registros",
                "info": "Registro: _START_ de _END_ - Total: _TOTAL_",
                "emptyTable": "No hay registros guardados",
                "zeroRecords": "No hay registros guardados",
                "infoEmpty": "No hay anuncios para mostrar",

                "pageLength": 10,

            },

            "dom": 'rt<"clear">'

        });
        
    }
    function consultatiposdepagodvp(e) {

        if ($.fn.dataTable.isDataTable('#tabladvp')) {
            tdvp= $('#tabladvp').DataTable();
        }
       
        var bdd = conexionbdd;
        var tabla = tablatiposdepago;
        var tipo = "consultatodo";
        var id=0;

        var datos = new Object();
        datos.id = id;
        datos.nombre = "";
        datos.bdd = bdd;
        datos.tabla = tabla;
        datos.tipo = tipo;
        var datosjson = JSON.stringify(datos);

        tdvp.clear().draw(true);
        arrdvp = [];
        $.ajax({

            url: "consultatiposdepago.php",
            data: { datos: datosjson },
            type: "post",

            success: function (data) {
                if (data != "consultavacia") {

                    dd = JSON.parse(data); //data decodificado

                    $.each(dd, function (key, value) {
                        if(dd[key].nodivisible==0)
                        {
                            var objeto = new Object();
                            objeto.tipopago = dd[key].id;
                            objeto.nombre = dd[key].nombre;
                            objeto.nombrecorto = dd[key].nombrecorto;
                            objeto.monto= 0;

                            // tptemp = dd[key].nombrecorto;
                            // tptemp = tptemp.trim();
                            // aca crea la tabla para completar con monto por pago
                            tdvp.row.add([
                                "<p style='text-align: center;' >" + dd[key].nombre + "</p>",
                                "<p style='text-align: center;' >" + dd[key].nombrecorto + "</p>",
                                "<input style='text-align: center;' onKeyUp ='return asignamonto(\"" + dd[key].id + "\")' id ='montodvp_" + dd[key].id + "' name ='montodvp_" + dd[key].id + "' type ='text' value=0 class='validate'></input>",
                            ]).draw(true);

                            arrdvp.push(objeto);

                           

                        }
                    });

                    tdvp.columns.adjust().draw();
                         
                } else {
                    M.toast({ html: 'No hay tipos de pago dados de alta.' });
                }
            },
            error: function (e) {
                alert("Error en la consulta." + e);
            }
        });

    }

    function asignamonto(idpasado){


        for(var a = 0 ;a < arrdvp.length;a++)
        {
            if(idpasado == arrdvp[a].tipopago)
                arrdvp[a].monto = document.getElementById("montodvp_" + idpasado).value;
        }
        
        //suma los montos para verificar si puede guardar
        totalmontodvp = 0;
        for (var a = 0; a < arrdvp.length; a++)
            totalmontodvp = totalmontodvp + Math.round(arrdvp[a].monto * 100) / 100;
        
        var montototalpedido = Math.round(document.getElementById("totalpedido").value * 100) / 100;


        if(totalmontodvp >=  montototalpedido)
             document.getElementById("procesarpedido").disabled = false;
        else
            document.getElementById("procesarpedido").disabled = true;
        
        return true;
    }


    function consultatiposdepagodvpquitar(itemparaquitar,e) {

            if ($.fn.dataTable.isDataTable('#tabladvpquitar')) {
                tdvpquitar = $('#tabladvpquitar').DataTable();
            }
            var bdd = conexionbdd;
            var tabla = tablatiposdepago;
            var tipo = "consultatodo";
            var id = 0;

            var datos = new Object();
            datos.id = id;
            datos.nombre = "";
            datos.bdd = bdd;
            datos.tabla = tabla;
            datos.tipo = tipo;
            var datosjson = JSON.stringify(datos);

            tdvpquitar.clear().draw(true);
            arrdvpquitar=[];
            $.ajax({

                url: "consultatiposdepago.php",
                data: { datos: datosjson },
                type: "post",

                success: function (data) {
                    if (data != "consultavacia") {

                        dd = JSON.parse(data); //data decodificado

                        $.each(dd, function (key, value) {
                            if (dd[key].nodivisible == 0) {
                                var objeto = new Object();
                                objeto.tipopago = dd[key].id;
                                objeto.nombre = dd[key].nombre;
                                objeto.nombrecorto = dd[key].nombrecorto;
                                objeto.itemparaquitar = itemparaquitar;
                               
                                for(var rec=0;rec < arrecobrado.length;rec++)
                                {
                                    if(arrecobrado[rec].tipopago ==  dd[key].nombrecorto){

                                        tdvpquitar.row.add([
                                            "<p style='text-align: center;' >" + dd[key].nombre + "</p>",
                                            "<p style='text-align: center;' >" + dd[key].nombrecorto + "</p>",
                                            "<input style='text-align: center;' onKeyUp ='return asignamontoquitar(\"" + dd[key].id + "\",\"" + arrecobrado[rec].monto + "\")' id ='montodvpquitar_" + dd[key].id + "' name ='montodvpquitar_" + dd[key].id + "' type ='text' class='validate' value = '"+ arrecobrado[rec].monto + "'></input>",
                                        ]).draw(true);
                                        objeto.monto = arrecobrado[rec].monto;
                                        arrdvpquitar.push(objeto);
                                    }
                                }
                            }
                        });

                        tdvpquitar.columns.adjust().draw();
                    } else {
                        M.toast({ html: 'No hay tipos de pago dados de alta.' });
                    }
                },
                error: function (e) {
                    alert("Error en la consulta." + e);
                }
            });

        }
        
    function asignamontoquitar(idpasado,montomaximo) {

       
        for (var a = 0; a < arrdvpquitar.length; a++) {
            if (idpasado == arrdvpquitar[a].tipopago)
                arrdvpquitar[a].monto = document.getElementById("montodvpquitar_" + idpasado).value;
        }

        //suma los montos para verificar si puede guardar
        var montototalquitar = Math.round(document.getElementById("montoeliminar").value * 100) / 100;
        var valora = document.getElementById("montodvpquitar_" + idpasado).value;
        

        totalmontodvpquitar=0;
        for (var a = 0; a < arrdvpquitar.length; a++)
            totalmontodvpquitar = totalmontodvpquitar + Math.round(arrdvpquitar[a].monto * 100) / 100;


        if (totalmontodvpquitar <= montototalquitar){
            document.getElementById("advertenciaquitar").innerText = "";
            document.getElementById("eliminarquitar").disabled = false;

        }
        else{
            document.getElementById("advertenciaquitar").innerText = "Advertencia: La suma de los montos a quitar es mayor al monto del item a eliminar !";
        }

        
        montomaximo = Math.round(montomaximo);
        if(valora > montomaximo){
            document.getElementById("eliminarquitar").disabled = true;

        }
        else            
        {
            if( document.getElementById("eliminarquitar").disabled == false)
                document.getElementById("eliminarquitar").disabled = false;
        }

        return true;
    }
</script>