

        <div class="filafondo row justify-content-center align-items-center mt-3 pt-2">
            <div class="col-sm-3">
                <h5 style="color: white;">Compras y Ajustes<i class="small material-icons"  style="color: white;">layers</i></h5>
            </div>

            <div class="col-sm-2 mt-2">                
                <input  id="fechacompraajuste" type="text" style="font-size: 1.15em;" class="datepicker center" readonly>
            </div>

            <div class="col-sm-2">
                <label for="numerocomprobantecompra" class=" bd-highlight colorletras">Número de comprobante de Compra</label>
            </div>

            <div class="col-sm-2 center">
                <input id="numerocomprobantecompra" style="background-color: white;text-align: center;" class="border border-success" type="text" maxlength="30">
            </div>

            <div class="col-sm-3">
                <button id="nuevoproductocompras" style="color: white;" class="waves-effect waves-light btn-small"><i
                        class="material-icons right">add_box</i>Nuevo Producto</button>
            </div>

        </div>

               
        <div class="row">
            <div class="col-sm-12">
               
                <div class="row justify-content-center bd-highlight mb-4 p-4">
                    <div class="col-sm-4">
                        <label for="opcioneslistaproveedores" class="colorletras">Proveedor</label>
                        <select class="form-control" id="opcioneslistaproveedores" name="opcioneslistaproveedores"></select>
                    </div>
                    <div class="col-sm-3">
                        <label for="opcioneslistatiposmovimientostock" class="colorletras">Tipo de movimiento</label>
                        <select class="form-control" id="opcioneslistatiposmovimientostock" name="opcioneslistatiposmovimientostock"></select>
                    </div>
                </div>
                <div class=" col-sm-2">
                    <input style="display: none;" id="idproveedorelegido" name="idproveedorelegido" type="text" >
                    <input style="display: none;" id="proveedorelegido" name="proveedorelegido" type="text">
                    <input style="display: none;" id="idtipomovimientostockelegido" name="idtipomovimientostockelegido" type="text">
                    <input style="display: none;" id="tipomovimientostockelegido" name="tipomovimientostockelegido" type="text">
                </div>
                
                <div id="divBuscador" class="row justify-content-center p-4">
                    <!-- ------------INSERTA COMPONENTE BUSQUEDA------------------- -->
                
                
                    <!-- ---------------------------------------------------------- -->
                </div>
                <!-- ---------- OBJETO BASE PARA ALTA DE PRODUCTOS-------------- -->
                <div id="divNuevoProducto" style="display: none;"  class="row">
                    
                </div>
                <!-- --------------------------------- -->
                <div class="row justify-content-start"  style="display: none;">
                    <button id="actualizarcompras" class="btn btn-primary">Actualizar <i class="fas fa-autorenew"></i></button>
                </div>


                <div id="tablaproductoscompras" style="display: none;"  class="table-responsive">
                    <table id="tablaanunciosmovimientos" class="display table table-striped" style="width: 100%!important;">
                        <thead>
                            <tr>
                                <!-- <th style="display: none;" class="columnadedos center">Stock inicio</th> -->
                                <th>Id</th>
                                <th>Código Barra</th>
                                <th>Título</th>

                                <th class="columnadedos center">Menos</th>
                                <th class="columnadetres center">cantidad Unid.Compradas</th>
                                <th class="columnadedos center">Unidad de Compra.</th>
                                <th class="columnadedos center">Unidad de Venta</th>
                                <th class="columnadedos center">Mas</th>
                                <th class="columnadetres center ">Costo x Unid.Compra</th>
                                <th class="columnadetres center ">$ Vta x Unid.Compra</th>
                                <th class="columnadetres center">Guardar</th>
                                <th class="columnadetres">Imagen</th>
                                <th class="columnadetres center ">Stock</th>
                                <th class="columnadedos center">en Unid/Compra.</th>

                                <!-- <th style="display: none;">Inicio stock</th> -->

                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <!-- <td style="display: none;" class="columnadedos center"></td> -->
                                <td></td>
                                <td></td>
                                <td></td>
                                <td class="columnadedos center"></td>
                                <td class="columnadetres center"></td>
                                <td class="columnadedos center"></td>
                                <td class="columnadedos center"></td>
                                <td class="columnadetres center blockcosto"></td>
                                <td class="columnadetres center blockmodiprecio"></td>
                                <td class="columnadedos center"></td>
                                <td class="columnadetres center"></td>
                                <td class="columnadetres "></td>
                                <td class="columnadetres center blockstock"></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="accordion" id="accordionExample">

            <!-- <div id="collapseCompras" aria-labelledby="headingCompras" data-parent="#accordionExample"> -->
                
                <!-- <div class="card-body"> -->

                <div class="card">
                    <div class="card-header" id="headingComprasAjustes">
                        
                        <h2 class="m-0">
                            <button id="consultacomprasajustes" class="btn collapsed" type="button" data-toggle="collapse" data-target="#collapseConsultaCompras" aria-expanded="false" aria-controls="collapseConsultaCompras">
                            Consultar Compras y Ajustes
                            </button>
                        </h2>

                        
                        
                    </div>
                    <div id="collapseConsultaCompras" class="collapse" aria-labelledby="headingComprasAjustes" data-parent="#accordionExample">
                        
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="d-flex flex-row justify-content-center bd-highlight">
                                        <div class="col-sm-3">
                                            <h5>Consulta entre dias</h5>
                                        </div>
                                        <div class="col-sm-3">
                                            <label for="fechamovimientodesde" class=" bd-highlight colorletras"> Desde Fecha</label>
                                            <input id="fechamovimientodesde" type="text" class="datepicker center" readonly>
                                        </div>
                                        <div class="col-sm-3">
                                            <label for="fechamovimientohasta" class=" bd-highlight colorletras">Hasta Fecha</label>
                                            <input id="fechamovimientohasta" type="text" class="datepicker center" readonly>
                                        </div>
                                        <div class="col-sm-3">
                                            <label for="totalcompras" class=" bd-highlight colorletras">Total Compras</label>
                                            <input id="totalcompras" type="text" class="text center" readonly>
                                        </div>
                                    </div>
                                </div>



                                <div class="col-sm-12 notapedido">
                                    <div class="d-flex flex-row justify-content-center bd-highlight">
                                        <div class="col-sm-12">
                                            <h5>Compras</h5>
                                        </div>
                                
                                    </div>
                                    <div class="row justify-content-center bd-highlight">
                                        
                                        <div class="col-sm-2">
                                            <label for="subtotalcomprobante" class=" bd-highlight colorletras">Total comprobante</label>
                                            <input id="subtotalcomprobante" type="text" readonly style="text-align:center;">
                                        </div>
                                        <div class="col-sm-2 center">
                                            <label for="comprobanteconsulta" class=" bd-highlight colorletras">Comprobante a consultar</label>
                                            <input id="comprobanteconsulta" style="background-color: white;text-align: center;"
                                                class="border border-success" type="text" maxlength="30">
                                        </div>
                                        
                                        <div class="col-sm-2">
                                            <button id="consultarcomprobante" style="color: white;" class="waves-effect waves-light btn-small"><i
                                                    class="material-icons right">search</i>Consultar</button>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table id="tablamovimientostock" class="display table table-striped" style="width: 100%!important;">
                                            <thead>
                                                <tr>
                                                    <th >fecha compra</th>
                                                    <th >Comprobante</th>
                                                    <th>Id</th>
                                                    <th>Código Barra</th>
                                                    <th>Título</th>
                                                    <th class="masmenoscolumna">cantidad</th>
                                                    <th class="masmenoscolumna">Unididad de Compra</th>
                                                    <th >Costo compra</th>
                                                    <th class="masmenoscolumna ">Precio Vta</th>
                                                    
                                                    <th>Proveedor</th>
                                                    <th class="masmenoscolumna">Tipo movimiento</th>
                                                    <th >Eliminar</th>

                                                    <th>Total comprado</th>
                                                    <th>Unid.Venta</th>
                                                    <th>Subtotal $</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td class="masmenoscolumna"></td>
                                                    <td></td>
                                                    
                                                    <td class="blockcosto"></td>
                                                    <td class="masmenoscolumna blockmodiprecio"></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td class="blockeliminar"></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-12 notapedido">
                                    <div class="d-flex flex-row justify-content-center bd-highlight">
                                        <div class="col-sm-12">
                                            <h5>Ajustes</h5>
                                        </div>
                            
                                    </div>
                                    <div class="table-responsive">
                                        <table id="tablamovimientostockajuste" class="display table table-striped" style="width: 100%!important;">
                                            <thead>
                                                <tr>
                                                    <th>fecha ajuste</th>
                                                    <th>Título</th>
                                                    <th>Descripción</th>
                                                    <th class="masmenoscolumna">Cantidad ajustada</th>
                                                    
                                                    <th>Unid. Vta</th>
                                                    <th class="masmenoscolumna">Tipo movimiento</th>
                                                    <th>Eliminar</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td class="masmenoscolumna"></td>
                                                    
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                                                    
                                
                        
                    </div>
                </div>

            <!-- </div> -->
        </div>
    <!-- </body>
</html> -->


<script>


function validarentercompras(e) {
    var key = window.event ? e.which : e.keyCode;

    if (key == 13) {

        textobuscado = $("#cajabusquedacompras").val();
        textobuscado = document.getElementById("cajabusquedacompras").value;

        if (textobuscado == "") {
            return false;
        }

        consultaranunciosparamovimientos("consultafiltros","nolector");
        verificabloqueo();

        M.toast(
            {
                html: 'Buscando productos...',
                displayLength: '3000'
            });
    }
}

$(document).ready(function () 
{
   

    configuracalendario();
    
    consultarubros_seleccion_lista(); //llena la lista del buscador
    consultaproveedores_seleccion_lista(); //llena la lista del buscador
    consultatiposdemovimiento_seleccion_lista(); //llena la lista con tipos de movmimiento
    imageneszoom();
    configuraciontablamovimientostockajuste();
    configuraciontablamovimientosstock();
    configuraciontablamovimiento();

    function inicioconsulta(){

        //agrego un texto que mejora la vista para buscar
        var newItem = document.createElement("h5");
        var textnode = document.createTextNode("Filtro de productos");
        newItem.appendChild(textnode);

        var taf = document.getElementById("tablaanunciosmovimientos_filter");
        taf.insertBefore(newItem, taf.childNodes[0]);
    }

    //inicioconsulta();


    llama = "comprar";
    $("#divBuscador").load("componentebuscador.html");
    $("#opciones").change(function () {
        var o = document.getElementById("opciones");
        var opcion = o.options[o.selectedIndex].text;
        document.getElementById('rubro').value = opcion;
    });

    $('#tablaanunciosmovimientos').on('page.dt', function () {
        imageneszoom();
    });

    $('#tablaanunciosmovimientos').on('draw.dt', function () {
        imageneszoom();
    });

    
    $("#fechacompraajuste").change(function () {

        var fechamovimiento = $("#fechacompraajuste").val();
     
        $("#fechamovimientodesde").val(fechamovimiento);
        $("#fechamovimientohasta").val(fechamovimiento);

        fechamovimientoenviada = conviertefechaastringdmy(fechamovimiento);
        consultarcomprasdeldia(fechamovimientoenviada, fechamovimientoenviada);

        tipomovimientonombrecorto = eligetipomovimiento();
        consultarajustesdeldia(fechamovimientoenviada,fechamovimientoenviada);

        verificabloqueo();

    });

    
    $("#fechamovimientodesde").change(function () {
        if ($("#fechamovimientodesde").val() != "" && $("#fechamovimientohasta").val() != "") {
            desdehasta();
            desdehastaajuste();
            verificabloqueo();

        }
    });

     $("#fechamovimientohasta").change(function () {
        if ($("#fechamovimientodesde").val() != "" && $("#fechamovimientohasta").val() != "") {
            desdehasta();
            desdehastaajuste();
        }
    });

    $("#consultacomprasajustes").click(function(){

        if (! $("#collapseConsultaCompras").hasClass("show"))
        {
            if ($("#fechamovimientodesde").val() != "" && $("#fechamovimientohasta").val() != "") {
                desdehasta();
                desdehastaajuste();
            }
        }
    });

    $("#consultarcomprobante").click(function(){
        consultarcomprobantecompra();
        verificabloqueo();

    });

    function colocafechaactual() {


        var f = new Date();
        var mes = f.getMonth() + 1;

        if (mes < 10) {
            mes = "0" + mes;
        }

        var dia = f.getDate();
        if (dia.toString().length == 1) {
            dia = "0" + dia;
        }
        var fechaactual = dia + "-" + mes + "-" + f.getFullYear();
        document.getElementById("fechamovimientodesde").value = fechaactual;
        document.getElementById("fechamovimientohasta").value = fechaactual;
        document.getElementById("fechacompraajuste").value = fechaactual;
        

        desdehasta();
        desdehastaajuste();
    }
    colocafechaactual();

    $("#opcioneslistaproveedores").change(function () {
        var o = document.getElementById("opcioneslistaproveedores");
        var opcion = o.options[o.selectedIndex].text;
        document.getElementById('proveedorelegido').value = opcion;
        
    });

    $("#opcioneslistatiposmovimientostock").change(function () {
        var o = document.getElementById("opcioneslistatiposmovimientostock");
        var opcion = o.options[o.selectedIndex].text;
        document.getElementById('tipomovimientostockelegido').value = opcion;
        
        eligetipomovimiento();

        if (opcion != "Compra" && opcion != "Seleccione un tipo de movimiento") {

            Swal.fire(
                'Recuerde',
                'la cantidad a ajustar es en UNIDAD DE VENTA y NO en unidad de compra. Ej:gr, cm, etc',
                'warning'
            )
        }
    });

    $('.tooltipped').tooltip();

    $("#divNuevoProducto").load("basealtaanuncio.html");

    verificabloqueo();

});


    
$("#nuevoproductocompras").click(function(){

    MostrarDivNuevoProducto();
});

function MostrarDivNuevoProducto()
{   
    if($("#divNuevoProducto").hasClass("show"))
    {
        $("#divNuevoProducto").css('display','none');
        $("#divNuevoProducto").removeClass('show');
    }
    else
    {
        $("#divNuevoProducto").css('display','block');
        $("#divNuevoProducto").addClass('show');
    }
}

    $("#actualizarcompras").click(function () {

        volverAconsultar();
    });


</script>