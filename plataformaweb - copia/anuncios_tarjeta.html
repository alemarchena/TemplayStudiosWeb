<div class="d-flex flex-row justify-content-center bd-highlight mb-5">
    <div class="col-sm-4">
        <label style="color: #260909!important;" for="opciones">Encontrá aquí nuestros productos</label>
            <select class="form-control border border-success" id="opciones" name="opciones"></select>
        </span>
    </div>
</div>

<div id="buscadosenprecios" class="row justify-content-center"> 
    
</div>
<script>

    var bdd = conexionbddpaginaweb;
    var rutadeimagenes = rutaimagenespaginaweb;
    var tabla = tablaanunciospaginaweb;
    var tabladerubros = tablarubrospaginaweb;

    function consultaranunciostarjeta(e)
    {
        var trabajacomonovedad = false;
        var seleccion = document.getElementById("opciones");
        // var seleccionrubro = seleccion.options[seleccion.selectedIndex].text;
        
        var seleccionidrubro = document.getElementById("opciones").value;
    

        if (seleccionidrubro != "")
        {
            var tipo;

            tipo = "consultarubros";

            var t=null;
            var id="";

            if (id == "") id = 0;
            else id = id;

            var itemanuncio = new Object();

            itemanuncio.bdd = bdd;
            itemanuncio.tabla = tabla;
            itemanuncio.tablarubros = tabladerubros;

            itemanuncio.tipo = tipo;
            itemanuncio.id = id;

            itemanuncio.titulo = "";
            itemanuncio.descripcion = "";
            itemanuncio.precio = "";
            itemanuncio.costo = "";
            itemanuncio.esnovedad = "";
            itemanuncio.esoferta = "";
            itemanuncio.nopublicar = "";
            itemanuncio.observaciones = "";
            itemanuncio.comentarios = "";

            itemanuncio.rutaimagenes = rutadeimagenes;
            itemanuncio.idrubro = seleccionidrubro;
            itemanuncio.imagen = "";
            itemanuncio.filtro = "";

            var objetoanuncio = JSON.stringify(itemanuncio);

             sn = $('#buscadosenprecios div');
            sn.each(function () {
                $(this).remove();
            });

            
            t = $('#buscadosenprecios');
            $(".hijos").remove();

            $.ajax({
                url: "consultaanuncios.php",

                data: { objetoanuncio: objetoanuncio},
                type: "post",

                success: function (data)
                {

                    if (data != '[]') {
                        
                        dd = JSON.parse(data); //data decodificado
                        var cuenta = 0;

                        $.each(dd, function (key, value) 
                        {
                            cuenta = cuenta + 1;

                            var parteobservacion = "";
                            var partecomentarios = "";
                            var colapsocomentarios="";
                            var colapsoobservaciones="";

                            if (dd[key].observaciones != ""){
                                parteobservacion = "<div class='col'><p><a class='btn light-green lighten-3 text-green darken-4 textobotonextras' data-toggle='collapse' href='#collapseObservaciones" + cuenta + "' role='button' aria-expanded='false' aria-controls='collapseObservaciones" + cuenta + "'>Saber mas...</a></p></div>";
                                colapsoobservaciones = "<div class='collapse' id='collapseObservaciones" + cuenta + "'><div class='card card-body extradescripcion'>" + dd[key].observaciones + "</div></div>";
                            }

                            if (dd[key].comentarios != ""){
                                partecomentarios = "<div class='col'><p><a class='btn light-green lighten-3 yellow-text text-lighten-5 brown darken-1 textobotonextras' data-toggle='collapse' href='#collapseComentarios" + cuenta + "' role='button' aria-expanded='false' aria-controls='collapseComentarios" + cuenta + "'>Sugerencias</a></p></div>";
                                colapsocomentarios= "<div class='collapse' id='collapseComentarios" + cuenta + "'><div class='card card-body extradescripcion'>" + dd[key].comentarios + "</div></div>";
                            }

                            if (dd[key].nopublicar == 0) 
                            {
                                if(trabajacomonovedad==true){
                                    if(dd[key].esnovedad==1)
                                    {
                                        var precio;
                                        if  (dd[key].precio > 0)
                                            precio = "$ " + dd[key].precio;
                                        else
                                            precio = "Consultar Precio";
                                            t.append("<div class='col-sm-3 hijos'><div class='card'><div class='row'><img src='" + rutaimagenes + dd[key].imagen + "' class='card-img-top materialboxed center-align tamaimagen' alt='...'></img></div><div class='card-body'><h5 id='titulotarjeta' class='center'>" + dd[key].titulo + "</h5><p  id='descripciontarjeta' class='card-text'>" + dd[key].descripcion + "</p><hr><p id='preciotarjeta' class='center'>" + precio + "</p></div> <div class='row'>" + parteobservacion + partecomentarios + "</div> <div class='row'>" + colapsoobservaciones + "</div> <div class='row'>" + colapsocomentarios + "</div> </div></div>");
                                    }
                                }else
                                {
                                    t.append("<div class='col-sm-3 hijos'><div class='card'><div class='row'><img src='" + rutadeimagenes + dd[key].imagen + "' class='card-img-top materialboxed center-align tamaimagen' alt='...'></img></div><div class='card-body'><h5 id='titulotarjeta' class='center'>" + dd[key].titulo + "</h5><p id='descripciontarjeta' class='card-text'>" + dd[key].descripcion + "</p></div><div class='row'> " + parteobservacion + partecomentarios + "</div> <div class='row'>" + colapsoobservaciones + "</div> <div class='row'>" + colapsocomentarios + "</div> </div></div>");
                                }
                            }
                        });

                        imageneszoom();

                        var alturamenu = $('.menu').outerHeight(true);
                        var iraqui = $("#seccionnovedades").offset().top - alturamenu;
                        $("HTML, BODY").animate({ scrollTop: iraqui }, velocidadscroll);
                        
                    }else{
                        if(seleccionidrubro!="")
                        {
                            Swal.fire({
                                closeOnEsc: false,
                                title: 'No hay novedades para este rubro!',

                            })
                        }
                    }
                },
                error: function (e) 
                {
                        M.toast(
                            {
                                html: 'No hay buena conexión!',
                                displayLength: '4000'
                            });
                    console.log("Error de comunicación");
                }
            });
        }

        $("#navbar-collapse").collapse("hide");
        var poscontacto = $("#buscadosenprecios").offset().top - alturamenu;
        $("HTML, BODY").animate({ scrollTop: poscontacto }, velocidadscroll);
    }

    $(document).ready(function ()
    {
        window.addEventListener("load", inicio);

        function inicio()
        {
            consultarubros_seleccionpaginaweb();
            consultaranunciostarjeta();
        }

        consultarubros_seleccionpaginaweb();
  

        $('#tablaanuncios').on('page.dt', function () {
            imageneszoom();
            var poscontacto = $("#seccionnovedades").offset().top - alturamenu;
            $("HTML, BODY").animate({ scrollTop: poscontacto }, velocidadscroll);
            $("#navbar-collapse").collapse("hide");
        });

        $("#botbuscartarjeta").on('click', function (e) {
            e.preventDefault();
            M.toast(
                {
                    html: '...Buscando',
                    displayLength: '3000'
                });
            consultaranunciostarjeta();
            var poscontacto = $("#seccionnovedades").offset().top - alturamenu;
            $("HTML, BODY").animate({ scrollTop: poscontacto }, velocidadscroll);
            $("#navbar-collapse").collapse("hide");
           
        });

        $("#opciones").on('change',function(){
            consultaranunciostarjeta();
            M.toast(
            {
                html: '...Buscando',
                displayLength: '3000'
            });
        });

        
    });
</script>